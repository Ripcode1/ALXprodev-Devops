#!/bin/bash

# Task 3: Summarize PokÃ©mon Data
# Generates a CSV report with Pokemon stats and calculates averages

INPUT_DIR="pokemon_data"
OUTPUT_CSV="pokemon_report.csv"

# Check if input directory exists
if [ ! -d "$INPUT_DIR" ]; then
    echo "Error: $INPUT_DIR directory not found!"
    exit 1
fi

# Create CSV header
echo "Name,Height (m),Weight (kg)" > "$OUTPUT_CSV"

# Initialize variables for average calculation
total_height=0
total_weight=0
count=0

# Process each JSON file
for json_file in "$INPUT_DIR"/*.json; do
    if [ -f "$json_file" ]; then
        # Extract data using jq
        name=$(jq -r '.name' "$json_file" | sed 's/.*/\u&/')
        height=$(jq -r '.height' "$json_file")
        weight=$(jq -r '.weight' "$json_file")
        
        # Convert height from decimeters to meters
        height_m=$(echo "$height" | awk '{printf "%.1f", $1/10}')
        
        # Convert weight from hectograms to kg
        weight_kg=$(echo "$weight" | awk '{printf "%.1f", $1/10}')
        
        # Add to CSV
        echo "$name,$height_m,$weight_kg" >> "$OUTPUT_CSV"
        
        # Accumulate for averages
        total_height=$(echo "$total_height $height_m" | awk '{print $1 + $2}')
        total_weight=$(echo "$total_weight $weight_kg" | awk '{print $1 + $2}')
        count=$((count + 1))
    fi
done

# Calculate averages
if [ $count -gt 0 ]; then
    avg_height=$(echo "$total_height $count" | awk '{printf "%.2f", $1/$2}')
    avg_weight=$(echo "$total_weight $count" | awk '{printf "%.2f", $1/$2}')
else
    echo "Error: No Pokemon data files found!"
    exit 1
fi

# Display report
echo "CSV Report generated at: $OUTPUT_CSV"
echo ""
cat "$OUTPUT_CSV" | column -t -s','
echo ""
echo "Average Height: $avg_height m"
echo "Average Weight: $avg_weight kg"
